<div class="article-toc" data-component="article_toc" {% if sticky %}data-sticky{% endif %}>
  {% if prefix %}
  <div class="article-toc-prefix">
    {% slot prefix %}{% endslot %}
  </div>
  {% endif %}
  
  <div class="article-toc-header">
    <h3 class="article-toc-title">
      {% component "icon" with name="list" library="feather" size="md" %}
      {% endslot %}
      {{ title }}
    </h3>
    {% if collapsible %}
    <button class="article-toc-toggle" data-toc-toggle>
      {% component "icon" with name="chevron-down" library="feather" size="sm" %}
      {% endslot %}
    </button>
    {% endif %}
  </div>
  
  <div class="article-toc-content" data-toc-content>
    {% if toc and toc|length > 0 %}
    <nav class="article-toc-nav">
      <ul class="article-toc-list">
        {% for item in toc %}
        {% set item_depth = item.depth %}
        {% if item_depth <= max_depth %}
        <li class="article-toc-item" data-depth="{{ item_depth }}">
          <a href="#{{ item.anchor }}" class="article-toc-link" data-toc-link data-target="{{ item.anchor }}">
            {% if show_numbers %}
            <span class="article-toc-number">{{ loop.index0 + 1 }}.</span>
            {% endif %}
            <span class="article-toc-text">{{ item.title }}</span>
            {% if item.children and item.children|length > 0 %}
            <span class="article-toc-toggle-icon">
              {% component "icon" with name="chevron-right" library="feather" size="sm" %}
              {% endslot %}
            </span>
            {% endif %}
          </a>
          
          {% if item.children and item.children|length > 0 %}
          <ul class="article-toc-children" data-toc-children>
            {% for child in item.children %}
            {% set child_depth = child.depth %}
            {% if child_depth <= max_depth %}
            <li class="article-toc-item" data-depth="{{ child_depth }}">
              <a href="#{{ child.anchor }}" class="article-toc-link" data-toc-link data-target="{{ child.anchor }}">
                {% if show_numbers %}
                <span class="article-toc-number">{{ loop.parent.index0 + 1 }}.{{ loop.index0 + 1 }}</span>
                {% endif %}
                <span class="article-toc-text">{{ child.title }}</span>
                {% if child.children and child.children|length > 0 %}
                <span class="article-toc-toggle-icon">
                  {% component "icon" with name="chevron-right" library="feather" size="sm" %}
                  {% endslot %}
                </span>
                {% endif %}
              </a>
              
              {% if child.children and child.children|length > 0 %}
              <ul class="article-toc-children" data-toc-children>
                {% for grandchild in child.children %}
                {% set grandchild_depth = grandchild.depth %}
                {% if grandchild_depth <= max_depth %}
                <li class="article-toc-item" data-depth="{{ grandchild_depth }}">
                  <a href="#{{ grandchild.anchor }}" class="article-toc-link" data-toc-link data-target="{{ grandchild.anchor }}">
                    {% if show_numbers %}
                    <span class="article-toc-number">{{ loop.parent.parent.index0 + 1 }}.{{ loop.parent.index0 + 1 }}.{{ loop.index0 + 1 }}</span>
                    {% endif %}
                    <span class="article-toc-text">{{ grandchild.title }}</span>
                  </a>
                </li>
                {% endfor %}
              </ul>
              {% endif %}
            </li>
            {% endfor %}
          </ul>
          {% endif %}
        </li>
        {% endif %}
        {% endfor %}
      </ul>
    </nav>
    {% else %}
    <div class="article-toc-empty">
      <p>No table of contents available.</p>
    </div>
    {% endif %}
  </div>
  
  {% if suffix %}
  <div class="article-toc-suffix">
    {% slot suffix %}{% endslot %}
  </div>
  {% endif %}
</div>