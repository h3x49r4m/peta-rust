<div class="code-viewer" data-component="code_viewer" data-theme="{{ theme }}" data-language="{{ language }}">
  {% slot header %}
  <header class="code-viewer-header">
    <div class="code-viewer-info">
      {% if filename %}
      <span class="code-viewer-filename">{{ filename }}</span>
      {% endif %}
      
      {% if language %}
      <span class="code-viewer-language">{{ language }}</span>
      {% endif %}
    </div>
    
    <div class="code-viewer-actions">
      {% if show_copy_button %}
      <button class="code-viewer-action code-viewer-action--copy" data-action="copy" title="Copy code">
        {% component "icon" with name="copy" library="feather" size="sm" %}
        {% endslot %}
      </button>
      {% endif %}
      
      {% if show_download_button %}
      <button class="code-viewer-action code-viewer-action--download" data-action="download" title="Download code">
        {% component "icon" with name="download" library="feather" size="sm" %}
        {% endslot %}
      </button>
      {% endif %}
      
      {% if show_fullscreen_button %}
      <button class="code-viewer-action code-viewer-action--fullscreen" data-action="fullscreen" title="Toggle fullscreen">
        {% component "icon" with name="maximize" library="feather" size="sm" %}
        {% endslot %}
      </button>
      {% endif %}
    </div>
  </header>
  {% endslot %}
  
  <div class="code-viewer-content" data-content>
    <div class="code-viewer-code-container" data-code-container style="max-height: {{ max_height }}">
      {% if show_line_numbers %}
      <div class="code-viewer-line-numbers" data-line-numbers>
        {% for line in code | split(pat="\n") %}
        <span class="code-viewer-line-number">{{ loop.index }}</span>
        {% endfor %}
      </div>
      {% endif %}
      
      <pre class="code-viewer-code" data-code><code class="language-{{ language }}">{{ code }}</code></pre>
    </div>
    
    {% if code | line_count > 10 %}
    <div class="code-viewer-expand">
      <button class="code-viewer-expand-btn" data-expand>
        <span class="code-viewer-expand-text">Show all {{ code | line_count }} lines</span>
        {% component "icon" with name="chevron-down" library="feather" size="sm" %}
        {% endslot %}
      </button>
    </div>
    {% endif %}
  </div>
  
  {% slot footer %}
  <footer class="code-viewer-footer">
    <div class="code-viewer-stats">
      <span class="code-viewer-stat">
        {% component "icon" with name="file-text" library="feather" size="xs" %}
        {% endslot %}
        {{ code | line_count }} lines
      </span>
      
      {% if code | length > 0 %}
      <span class="code-viewer-stat">
        {% component "icon" with name="hard-drive" library="feather" size="xs" %}
        {% endslot %}
        {{ (code | length / 1024) | round(precision=1) }} KB
      </span>
      {% endif %}
      
      {% if language %}
      <span class="code-viewer-stat">
        {% component "icon" with name="code" library="feather" size="xs" %}
        {% endslot %}
        {{ language }}
      </span>
      {% endif %}
    </div>
  </footer>
  {% endslot %}
</div>