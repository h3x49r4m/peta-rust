<!-- Book Modal Component -->
<div class="book-modal-overlay" id="book-modal-overlay" data-component="book_modal">
  <div class="book-modal-container">
    {{ component(name="reading_progress") | safe }}
    
    <!-- Modal Header -->
    <div class="book-modal-header">
      <div class="book-modal-header-content">
        <h2 class="book-modal-title">{{ book_title }}</h2>
        {% if book_author %}
        <p class="book-modal-author">by {{ book_author }}</p>
        {% endif %}
      </div>
    </div>

    <!-- Modal Body -->
    <div class="book-modal-body">
      <!-- Book TOC - Floating component (inlined to avoid Tera template conflicts) -->
      <div class="book-toc-wrapper" data-component="book_toc">
        <!-- Toggle Button -->
        <button class="book-toc-toggle-btn" id="book-toc-toggle" aria-label="Toggle Table of Contents" aria-expanded="false">
          <svg class="toc-icon toc-icon-closed" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v16c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2H6c-1.1 0-2 .9-2 2zm0 0h16" />
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M4 8h16M4 12h16M4 16h16" />
          </svg>
          <svg class="toc-icon toc-icon-open" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16M12 4c0-1.1-2.2-2-5-2s-5 .9-5 2v16c0-1.1 2.2-2 5-2s5 .9 5 2M12 4c0-1.1 2.2-2 5-2s5 .9 5 2v16c0-1.1-2.2-2-5-2s-5 .9-5 2" />
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M7 7c1.5 0 3 .5 3 1.5M7 10c1.5 0 3 .5 3 1.5M7 13c1.5 0 3 .5 3 1.5M17 7c-1.5 0-3 .5-3 1.5M17 10c-1.5 0-3 .5-3 1.5M17 13c-1.5 0-3 .5-3 1.5" />
          </svg>
        </button>
        
        <!-- TOC Content Panel -->
        <div class="book-toc-panel" id="book-toc-panel">
          <div class="book-toc-header">
            <h3 class="book-toc-title">{{ book_title }}</h3>
          </div>
          <div class="book-toc-content" id="book-toc-content">
            {% if book_toc %}
            {{ book_toc | safe }}
            {% else %}
            <p class="toc-empty">No chapters available</p>
            {% endif %}
          </div>
        </div>
      </div>
      
      <!-- Book Content -->
      <main class="book-modal-content">
        {% if content %}
        <div class="book-content" data-component="book_content">
          <div class="book-content-wrapper">
            {{ content | safe }}
          </div>
        </div>
        {% endif %}
      </main>
    </div>
  </div>
</div>
