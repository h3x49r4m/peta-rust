{% extends "base.html" %}

{% block title %}{{ page.title }} - {{ site.title }}{% endblock %}

{% block content %}
{{ component(name="page_tags", title="Snippets") | safe }}

{% if snippets %}
<div class="listing-grid">
  {% for snippet in snippets %}
  {{ component(name="grid_card", page=snippet) | safe }}
  {% endfor %}
</div>
{% else %}
<div class="text-center" style="padding: var(--spacing-16) 0;">
  <p style="color: var(--text-secondary); font-size: var(--font-size-lg);">No snippets found.</p>
</div>
{% endif %}

<!-- Snippet Modal Component -->
{{ component(name="snippet_card_modal") | safe }}

<!-- Snippet Content Container (for modal) -->
<div id="snippet-content-{{ page.extra.slug }}" class="snippet-content" style="display: none;">
    <h1>{{ page.title }}</h1>
    {% if page.language %}
    <p><strong>Language:</strong> {{ page.language }}</p>
    {% endif %}
    {{ content | safe }}
</div>
{% endblock %}

{% block scripts %}
{% if has_math_formulas %}
{{ math_render_script | safe }}
{% endif %}
<!-- Prism.js JavaScript -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-core.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/line-numbers/prism-line-numbers.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/copy-to-clipboard/prism-copy-to-clipboard.min.js"></script>



<script>
document.addEventListener('DOMContentLoaded', function() {
    // Auto-open modal with current snippet content
    const snippetContent = document.querySelector('.snippet-content');
    if (snippetContent && window.openSnippetModal) {
        // Extract language from code blocks if available
        const codeBlock = snippetContent.querySelector('.code-block-component');
        let language = '';
        if (codeBlock) {
            const langSpan = codeBlock.querySelector('.code-language');
            if (langSpan) {
                language = langSpan.textContent.trim();
            } else {
                const langAttr = codeBlock.getAttribute('data-language');
                if (langAttr) {
                    language = langAttr;
                }
            }
        }
        
        // Extract content properly - remove only the h1 title
        let content = snippetContent.innerHTML.replace(/<h1>.*?<\/h1>/, '').trim();
        
        // Clean up any empty paragraphs at the beginning
        content = content.replace(/^<p>\s*<\/p>/, '').trim();
        
        // Extract tags and date from page metadata if available
        const tags = [{% if page.tags %}{% for tag in page.tags %}'{{ tag }}'{% if not loop.last %},{% endif %}{% endfor %}{% else %}{% endif %}];
        const date = '{{ page.date | default(value="") }}';
        
        // Open modal immediately
        window.openSnippetModal({
            title: snippetContent.querySelector('h1')?.textContent || 'Snippet',
            language: language,
            content: content,
            tags: tags,
            date: date,
            hasMathFormulas: {% if has_math_formulas %}true{% else %}false{% endif %}
        });
    }
});
</script>
{% endblock %}